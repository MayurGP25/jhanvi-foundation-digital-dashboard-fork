<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Beneficiaries</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <script>
    window.history.forward();
    function noBack() { window.history.forward(); }
  </script>

  <style>
    body { background: radial-gradient(circle at top left, #e3f2fd, #f5f7fb); min-height: 100vh; }
    .app-header { backdrop-filter: blur(8px); background: rgba(15, 23, 42, 0.92); }
    .surface { border: none; border-radius: 18px; box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12); }
    .btn-pill { border-radius: 999px; }
    .table thead th { border-bottom: none; }
    .table-hover tbody tr:hover { background: #f2f5ff; }
  </style>
</head>

<body onload="noBack();" onpageshow="if (event.persisted) noBack();" onunload="">
  <nav class="navbar navbar-dark app-header shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="/dashboard">NGO Digital Dashboard</a>
      <div class="d-flex gap-2">
        <a href="/beneficiaries/menu" class="btn btn-outline-light btn-sm btn-pill">Back</a>
        <a href="/logout" class="btn btn-outline-light btn-sm btn-pill">Sign Out</a>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
      <div>
        <h1 class="fw-bold mb-1">Edit Beneficiaries</h1>
        <p class="text-muted mb-0">Search, edit and manage beneficiary records.</p>
      </div>
      <div class="d-flex gap-2">
        <a href="/beneficiaries/add" class="btn btn-primary btn-pill">Add Beneficiary</a>
        <a href="/beneficiaries/view" class="btn btn-outline-secondary btn-pill">View All</a>
      </div>
    </div>

    <!-- Search & Filter Card -->
    <div class="card surface mb-4">
      <div class="card-body">
        <form method="GET" action="/beneficiaries/edit" id="filterForm">
          <div class="row g-3">
            <!-- Name Search -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Beneficiary Name</label>
              <input
                type="text"
                name="search"
                class="form-control"
                placeholder="Search by name…"
                value="<%= searchQuery %>"
                style="border-radius:12px;"
              />
            </div>

            <!-- Gender Filter -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Gender</label>
              <select name="gender" class="form-select" style="border-radius:12px;">
                <option value="">All Genders</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Marital Status Filter -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Marital Status</label>
              <select name="marital_status" class="form-select" style="border-radius:12px;">
                <option value="">All Status</option>
                <option value="Single">Single</option>
                <option value="Married">Married</option>
                <option value="Divorced">Divorced</option>
                <option value="Widowed">Widowed</option>
              </select>
            </div>

            <!-- Education Filter -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Education</label>
              <input
                type="text"
                name="education"
                class="form-control"
                placeholder="Filter by education…"
                style="border-radius:12px;"
              />
            </div>

            <!-- Location Filter -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Location</label>
              <input
                type="text"
                name="location"
                class="form-control"
                placeholder="Filter by location…"
                style="border-radius:12px;"
              />
            </div>

            <!-- Health Status Filter -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Health Status</label>
              <input
                type="text"
                name="health_status"
                class="form-control"
                placeholder="Filter by health status…"
                style="border-radius:12px;"
              />
            </div>

            <!-- Stay Type Filter -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Stay Type</label>
              <input
                type="text"
                name="stay_type"
                class="form-control"
                placeholder="Filter by stay type…"
                style="border-radius:12px;"
              />
            </div>

            <!-- Age Range -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Min Age</label>
              <input
                type="number"
                name="min_age"
                class="form-control"
                placeholder="Min age"
                min="0"
                style="border-radius:12px;"
              />
            </div>

            <div class="col-12 col-md-6 col-lg-4">
              <label class="form-label small fw-semibold">Max Age</label>
              <input
                type="number"
                name="max_age"
                class="form-control"
                placeholder="Max age"
                min="0"
                style="border-radius:12px;"
              />
            </div>

            <!-- Action Buttons -->
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-end">
                <a href="/beneficiaries/edit" class="btn btn-outline-secondary btn-pill">Clear Filters</a>
                <button type="submit" class="btn btn-dark btn-pill">Apply Filters</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="card surface">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-dark">
              <tr>
                <th style="width:50px;">#</th>
                <th>Beneficiary Name</th>
                <th>Guardian Name</th>
                <th style="width:60px;">Age</th>
                <th style="width:90px;">Gender</th>
                <th>Education</th>
                <th style="width:110px;">Marital Status</th>
                <th style="width:80px;">Children</th>
                <th>Location</th>
                <th>Health Status</th>
                <th>Occupation</th>
                <th style="width:120px;">Contact No</th>
                <th>Reference</th>
                <th style="width:100px;">Stay Type</th>
                <th>Remarks</th>
                <th class="text-end" style="width:170px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (beneficiaries.length === 0) { %>
                <tr>
                  <td colspan="16" class="text-center py-5 text-muted">No records found.</td>
                </tr>
              <% } %>

              <% beneficiaries.forEach((ben, index) => { %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td class="fw-semibold"><%= ben.beneficiary_name %></td>
                  <td><%= ben.guardian_name || '-' %></td>
                  <td><%= (ben.age === null || typeof ben.age === 'undefined') ? '-' : ben.age %></td>
                  <td><%= ben.gender || '-' %></td>
                  <td><%= ben.education || '-' %></td>
                  <td><%= ben.marital_status || '-' %></td>
                  <td><%= (ben.children_count === null || typeof ben.children_count === 'undefined') ? '-' : ben.children_count %></td>
                  <td><%= ben.location || '-' %></td>
                  <td><%= ben.health_status || '-' %></td>
                  <td>
                    <% if (ben.occupation_id || ben.occupation_place) { %>
                      <div class="small">
                        <% if (ben.occupation_id) { %><div><%= ben.occupation_id %></div><% } %>
                        <% if (ben.occupation_place) { %><div class="text-muted"><%= ben.occupation_place %></div><% } %>
                      </div>
                    <% } else { %>
                      -
                    <% } %>
                  </td>
                  <td><%= ben.contact_no || '-' %></td>
                  <td>
                    <% if (ben.reference_name || ben.reference_address) { %>
                      <div class="small">
                        <% if (ben.reference_name) { %><div><%= ben.reference_name %></div><% } %>
                        <% if (ben.reference_address) { %><div class="text-muted"><%= ben.reference_address %></div><% } %>
                      </div>
                    <% } else { %>
                      -
                    <% } %>
                  </td>
                  <td><%= ben.stay_type || '-' %></td>
                  <td><%= ben.remarks || '-' %></td>
                  <td class="text-end">
                    <a href="/beneficiaries/edit/<%= ben.id %>" class="btn btn-sm btn-warning btn-pill">Edit</a>
                    <form method="POST" action="/beneficiaries/delete/<%= ben.id %>" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this beneficiary?');">
                      <button type="submit" class="btn btn-sm btn-outline-danger btn-pill">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
