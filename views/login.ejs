<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login - Jhanavi Foundation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
</head>

<body>
<div class="container mt-5">
    <div class="col-md-5 mx-auto card p-4 card-custom">
        <h3 class="text-center mb-3">Login</h3>

        <% if (typeof message !== 'undefined' && message) { %>
            <div class="alert alert-<%= type || 'info' %>" role="alert">
                <%= message %>
            </div>
        <% } %>

        <form action="/login" method="POST">

            <label>Email</label>
            <input type="email" class="form-control mb-3" name="email" required>

            <label>Password</label>
            <input type="password" class="form-control mb-3" name="password" required>

            <button class="btn btn-primary w-100 btn-rounded">Login</button>

            <div class="mt-3 d-flex justify-content-between">
                <span>Don't have an account? <a href="/signup">Sign up</a></span>
                <a href="#" data-bs-toggle="modal" data-bs-target="#forgotModal">Forgot password?</a>
            </div>
        </form>
    </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal fade" id="forgotModal" tabindex="-1" aria-labelledby="forgotModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="forgotModalLabel">Reset Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="forgotForm" action="/forgot-direct" method="POST" novalidate>
        <div class="modal-body">
          <div id="forgotErrors" class="alert alert-danger d-none" role="alert"></div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" name="email" id="forgotEmail" required>
          </div>
          <div class="mb-3">
            <label class="form-label">New Password</label>
            <input type="password" class="form-control" name="password" id="forgotPassword"
                   pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&]).{8,}"
                   title="Password must contain at least 1 uppercase, 1 lowercase, 1 digit, 1 special character and be 8+ characters long."
                   minlength="8" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Confirm Password</label>
            <input type="password" class="form-control" name="confirmPassword" id="forgotConfirm" minlength="8" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  (function() {
    const form = document.getElementById('forgotForm');
    const errorsBox = document.getElementById('forgotErrors');
    const emailEl = document.getElementById('forgotEmail');
    const passEl = document.getElementById('forgotPassword');
    const confirmEl = document.getElementById('forgotConfirm');

    function validatePasswordRules(pwd) {
      const re = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/;
      return re.test(pwd);
    }

    form.addEventListener('submit', function(e) {
      const errors = [];
      const email = emailEl.value.trim();
      const pwd = passEl.value;
      const confirm = confirmEl.value;

      if (!email || !pwd || !confirm) {
        errors.push('All fields are required.');
      }
      if (pwd !== confirm) {
        errors.push('Passwords do not match.');
      }
      if (pwd && !validatePasswordRules(pwd)) {
        errors.push('Password must contain at least 1 uppercase, 1 lowercase, 1 digit, 1 special character and be 8+ characters long.');
      }

      if (errors.length > 0) {
        e.preventDefault();
        errorsBox.classList.remove('d-none');
        errorsBox.innerHTML = errors.map(x => `<div>${x}</div>`).join('');
        const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('forgotModal'));
        modal.show();
      } else {
        errorsBox.classList.add('d-none');
        errorsBox.innerHTML = '';
      }
    });
  })();
</script>
</body>
</html>
